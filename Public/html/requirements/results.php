<?php/* * Created on Febrary 18, 2006 by @author aaronz * Aaron Zeckoski (aaronz@vt.edu) - Virginia Tech (http://www.vt.edu/) */?><?php	require_once ("tool_vars.php");	// Form to allow users to review the votes so far	$PAGE_NAME = "View Results";	// connect to database	require "mysqlconnect.php";	// get the passkey from the cookie if it exists	$PASSKEY = $_COOKIE["SESSION_ID"];	// check the passkey	$USER_PK = 0;	if (isset($PASSKEY)) {		$sql1 = "SELECT users_pk FROM sessions WHERE passkey = '$PASSKEY'";		$result = mysql_query($sql1) or die('Query failed: ' . mysql_error());		$count = mysql_num_rows($result);		$row = mysql_fetch_assoc($result);		if( empty($result) || ($count < 1)) {			// no valid key exists, user not authenticated			$USER_PK = 0;		} else {			// authenticated user			$USER_PK = $row["users_pk"];		}	mysql_free_result($result);	}	$USER = "";	if ($USER_PK) {		// get the authenticated user information		$authsql = "SELECT * FROM users WHERE pk = '$USER_PK'";		$result = mysql_query($authsql) or die('Query failed: ' . mysql_error());		$USER = mysql_fetch_assoc($result);	}?><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title><?= $TOOL_NAME ?> - <?= $PAGE_NAME ?></title><link href="./requirements_vote.css" rel="stylesheet" type="text/css"><script><!--function focus(){document.filter.searchtext.focus();}// --></script></head><body onLoad="focus();"><?php	// add in the display to let people know how long they have to vote	$EXTRA_LINKS = "<br/><div class='date_message'>";	$isRep = 0; // assume user is not an institutional rep	$not_allowed = 1; // assume user is NOT allowed unless otherwise shown	$Message = "";	if (strtotime($ROUND_CLOSE_DATE) < time()) {		// Normal folks cannot access until after the close date		$not_allowed = 0;		$EXTRA_LINKS .= "Voting closed " . date($ROUND_DATE_FORMAT,strtotime($ROUND_CLOSE_DATE));	} else if (strtotime($ROUND_SWITCH_DATE) < time()) {		// User must be a rep or no access		$check_rep_sql="select pk from institution where rep_pk = '$USER_PK'";		$result = mysql_query($check_rep_sql) or die('Query failed: ' . mysql_error());				if (mysql_num_rows($result) == 0) {			$not_allowed = 1;			$Message = "Results viewing is currently open to institutional representatives only.<br/>";						// get info on their institutional rep			$get_rep_sql="select U2.firstname, U2.lastname, U2.email, institution.name from institutionjoin users U1 on U1.institution_pk = institution.pk and U1.pk = '$USER_PK'left join institution I1 on I1.pk = U1.institution_pkleft join users U2 on U2.pk = I1.rep_pk";			$result = mysql_query($get_rep_sql) or die('Rep info Query failed: ' . mysql_error());			$line = mysql_fetch_row($result);			if (!empty($line) && (isset($line[2])) ) {				$Message .= "Your institutional representative for ".$line[3]." is " . $line[0] . " " . $line[1] . " (".$line[2].").";			} else {				$Message .= "There is no institutional representative defined for instituion: " . $line[3];			}		} else {			// user is an institutional rep			$isRep = 1;		}				$EXTRA_LINKS .= "Rep viewing from " . date($ROUND_DATE_FORMAT,strtotime($ROUND_SWITCH_DATE)) .			" to " . date($ROUND_DATE_FORMAT,strtotime($ROUND_CLOSE_DATE));	} else {		// No results viewing allowed		$Message = "Voting results cannot be viewed until voting is over on " .			date($ROUND_DATE_FORMAT,strtotime($ROUND_CLOSE_DATE));		$EXTRA_LINKS .= "Voting closes on " . date($ROUND_DATE_FORMAT,strtotime($ROUND_CLOSE_DATE));	}	$EXTRA_LINKS .= "</div>";?><? // Include the HEADER -AZinclude 'header.php'; ?><?= $Message ?><?php	// This part will punt the user out if they are not allowed to vote right now	// this is a nice punt in that it simply stops the rest of the page from loading -AZ	if ($not_allowed) {		include 'footer.php';		exit;	}?><form name="voteform" method="post" action="vote.php" style="margin:0px;"><div style="background:#ECECEC;border:1px solid #ccc;padding:3px;margin-bottom:10px;">	<table border=0 cellspacing=0 cellpadding=0 width="100%">	<tr>	<td nowrap="y">	<strong>Filters:</strong>&nbsp;&nbsp;	</td>	<td nowrap="y">		<select name="filter_items" title="Filter the requirements by my votes">			<option value="<?= $filter_items ?>" selected><?= $filter_items ?></option>			<option value="show all items">show all items</option>			<option value="show my voted items">show my voted items</option>			<option value="show my unvoted items">show my unvoted items</option>			<option value="show my critical items">show my critical items</option>			<option value="show my essential items">show my essential items</option>			<option value="show my desirable items">show my desirable items</option>			<option value="show my not applicable items">show my not applicable items</option>		</select>		<select name="filter_components" title="Filter the requirements by affected component">			<option value="<?= $filter_components ?>" selected><?= $filter_components ?></option>			<option value="show all components">show all components</option>			<option value="New Tool">New Tool</option>			<option value="Account">Account</option>			<option value="Aliases (Admin Site Management)">(Admin Site Management)</option>			<option value="Announcements">Announcements</option>			<option value="Assignments">Assignments</option>			<option value="Attachment Widget">Attachment Widget</option>			<option value="CRUD">CRUD</option>			<option value="Calendar Widget">Calendar Widget</option>			<option value="Chat Room">Chat Room</option>			<option value="Database">Database</option>			<option value="Discussion">Discussion</option>			<option value="Documentation (other than Help)">Documentation (other than Help)</option>			<option value="Drop box">Drop box</option>			<option value="E-mail Archive">E-mail Archive</option>			<option value="Gateway">Gateway</option>			<option value="Global">Global</option>			<option value="Gradebook">Gradebook</option>			<option value="Help">Help</option>			<option value="Home">Home</option>			<option value="Install">Install</option>			<option value="JSF">JSF</option>			<option value="Licensing">Licensing</option>			<option value="MOTD">MOTD</option>			<option value="Membership">Membership</option>			<option value="Memory (Admin Site Management)">Memory (Admin Site Management)</option>			<option value="My Workspace">My Workspace</option>			<option value="News (RSS)">News (RSS)</option>			<option value="OSIDs">OSIDs</option>			<option value="On-Line (Admin Site Management)">On-Line (Admin Site Management)</option>			<option value="Page Wrapper Widget">Page Wrapper Widget</option>			<option value="Permission Widget">Permission Widget</option>			<option value="Portal">Portal</option>			<option value="Preferences">Preferences</option>			<option value="Presence">Presence</option>			<option value="Presentation">Presentation</option>			<option value="Profile">Profile</option>			<option value="Providers">Providers</option>			<option value="Quartz Scheduler">Quartz Scheduler</option>			<option value="Realms (Admin Site Management)">Realms (Admin Site Management)</option>			<option value="Resources">Resources</option>			<option value="Roster">Roster</option>			<option value="Rwiki">Rwiki</option>			<option value="SUTool">SUTool</option>			<option value="Sakai APIs">Sakai APIs</option>			<option value="Sakai Application Framework">Sakai Application Framework</option>			<option value="Samigo - Authoring">Samigo - Authoring</option>			<option value="Samigo - Delivery">Samigo - Delivery</option>			<option value="Samigo - Global">Samigo - Global</option>			<option value="Samigo - Grading">Samigo - Grading</option>			<option value="Samigo - Question Pools">Samigo - Question Pools</option>			<option value="Samigo - Templates">Samigo - Templates</option>			<option value="Schedule">Schedule</option>			<option value="Section Info">Section Info</option>			<option value="Site Archive (Admin Site Management)">Site Archive (Admin Site Management)</option>			<option value="Site Info">Site Info</option>			<option value="Sites (Admin Site Management)">Sites (Admin Site Management)</option>			<option value="Sites (Gateway)">Sites (Gateway)</option>			<option value="Skins (CSS)">Skins (CSS)</option>			<option value="Style Guide">Style Guide</option>			<option value="Syllabus">Syllabus</option>			<option value="Tab Management">Tab Management</option>			<option value="Tests & Quizzes (Samigo)">Tests & Quizzes (Samigo)</option>			<option value="Twin Peaks">Twin Peaks</option>			<option value="Users (Admin User Management)">Users (Admin User Management)</option>			<option value="WYSIWYG Widget">WYSIWYG Widget</option>			<option value="Web Content">Web Content</option>			<option value="Web Services">Web Services</option>			<option value="WebDAV">WebDAV</option>			<option value="Worksite Information">Worksite Information</option>			<option value="Worksite Setup">Worksite Setup</option>		</select>		<select name="filter_audience" title="Filter the requirements by intended audience">			<option value="<?= $filter_audience ?>" selected><?= $filter_audience ?></option>            <option value="show all audiences">show all audiences</option>			<option value="Students"> Students</option>			<option value="Instructors">Instructors </option>			<option value="Researchers">Researchers</option>			<option value="Staff(administrative)">Staff(administrative)</option>			<option value="Sakai administrators">Sakai Administrators </option>			<option value="Sakai developers">Sakai Developers</option>		</select>		&nbsp;	    <input type="submit" name="filter" value="Filter" title="Apply the current filter settings to the page">	</td>	<td nowrap="y" align="right">        <input type="text" name="searchtext" value="<?= $searchtext ?>"        	length="20" title="Enter search text here">        <input type="submit" name="search" value="Search" title="Search the requirements">	</td>	</tr>	<tr>	<td nowrap="y"><b>Paging:</b></td>	<td nowrap="y" style="font-size:8pt;">		<input type="hidden" name="page" value="<?= $page ?>">		<input type="submit" name="paging" value="first" title="Go to the first page">		<input type="submit" name="paging" value="prev" title="Go to the previous page">		Page <?= $page ?> of <?= $total_pages ?>		<input type="submit" name="paging" value="next" title="Go to the next page">		<input type="submit" name="paging" value="last" title="Go to the last page">		&nbsp;-&nbsp;		Displaying <?= $start_item ?> - <?= $end_item ?> of <?= $total_items ?> items (<?= $items_displayed ?> shown)		&nbsp;-&nbsp;		Max of		<select name="num_limit" title="Choose the max items to view per page">			<option value="<?= $num_limit ?>"><?= $num_limit ?></option>			<option value="10">10</option>			<option value="25">25</option>			<option value="50">50</option>			<option value="100">100</option>		</select>		items per page	</td>	<td align="right">		<input type="submit" name="clearall" value="Clear All Filters" title="Reset all filters">	</td>	</tr>	</table></div><table class=main cellspacing="0"  border="0" >  <td  valign=top style="background:#ECECEC; padding-bottom: 10px; border: 1px solid #ccc; white-space: n"><!--   <strong>CONFERENCE REGISTRATION:</strong>  --><FORM ACTION="<?php echo($PHP_SELF); ?>" METHOD="POST"name="FORM_select_type" id="FORM_select_type"><p>Filter Requirements by:</p>Rank:<select name="rank">                <option value="all">show all rankings</option>                <option value="critical">Critical items</option>                <option value="essential">Essential items</option>                <option value="desireable">Desireable items</option>            </select>&nbsp; &nbsp; &nbsp; Contributions:          <select name="contribute"><option value="all">show all</option>                <option value="critical">show Contribute Resources</option>                <option value="essential">show Do not Contribute Resources</option>          </select>     &nbsp; &nbsp; &nbsp;Filter by Organization:                     <input tupe="text" name="organization" size=30 value=""><script language="JavaScript" type="text/javascript"><!--function function_submit_select_type(){document.FORM_select_type.submit();	}//--></script><noscript><input type="submit" value="submit" name="SUBMIT_select_type"></noscript></FORM> <br /></td></tr></table><?phprequire "mysqlconnect.php";	 	$sql="Select * from requirement_vote";			$reportName="All Requirement voting results";$result= mysql_query($sql);$resultsnumber=mysql_numrows($result);$line = "1";$row="0";echo"<table cellpadding=0 cellspacing=0 width=700px bgcolor:#fff  align=center border=0>		<tr><td border=0><br /><br /><strong>$reportName</strong></td></tr></table> <table  cellspacing=0><tr class=tableheader>	<td>Req#</td>	<td>Summary</td>	<td>Rank</td>	<td>Contribute</td>	<td>Describe Resources</td>	<td>Voter Name</td><td>Voter Organization</td></tr>";while($links=mysql_fetch_array($result)){$row++;$key=$links["key"];$summary=$links["summary"];$rank=$links["rank"];$contribute=$links["contribute"];$resource_info=$links["resource_info"];$name=$links["name"];$organization=$links["organization"];if ($line == 1) {	echo "<tr id=oddrow valign=top>";   $line='2';} else {	echo "<tr id=evenrow valign=top>";	$line='1';}	echo"	<td class=line_no>$key</td>	<td width=200px>$summary</td>	<td>$rank</td>	<td>$contribute</td>	<td>$resource_info</td>	<td>$name</td><td>$organization</td></tr>"; //end row, so change color} //end of whileecho"</table>";?></body></html>