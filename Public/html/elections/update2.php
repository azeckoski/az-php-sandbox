<?php // check file extension$fileNameParts = explode(".", $_FILES['userfile']['name']); $fileExtension = end($fileNameParts); // part behind last dot  if (($fileExtension == 'jpg') ||  ($fileExtension == 'JPEG')  ||($fileExtension == 'jpeg')  || ($fileExtension == 'JPG') || ($fileExtension == 'gif')   || ($fileExtension == 'GIF') ||  ($fileExtension == 'PNG') || ($fileExtension == 'png')) { $validExtension=TRUE;}If ($validExtension) {$validImage=TRUE;} else {$validImage=FALSE;$message[]="<li><strong>Upload Incomplete</strong><br />Error -  Image format must be jpg, gif, png, or bmp</li>"; }if ($validImage) {//complete upload and add to database//set location of file upload$uploadDir = '/afs/umich.edu/group/acadaff/sakai/Public/html/images/stories/election_photos/';$uploadFile = $uploadDir . ($_FILES['userfile']['name']);// get client side file name $filename= '../images/stories/election_photos/' . $_FILES['userfile']['name'];// userfile_error was introduced at PHP 4.2.0// use this code with newer versions$userfile_error = $_FILES['userfile']['error'];if ($userfile_error > 0) {$message[]= "<p><strong>Upload Incomplete</strong></p>";switch ($userfile_error) { case 1:$message[]= "<li>File exceeded upload_max_filesize</li>";break;case 2:$message[]=  "<li>File exceeded max_file_size</li>";break;case 3:$message[]=  "<li>File only partially uploaded</li>";break;case 4:$message[]=  "<li>No file uploaded</li>";break;case 6:$message[]=  "<li>Missing a temporary folder</li>";break;case 7:$message[]=  "<li>Failed to write file to disk.</li>";break;}}if (is_uploaded_file($_FILES['userfile']['tmp_name'])) {      if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadFile))       {     $first=addslashes($_POST['firstname']);$last=addslashes($_POST['lastname']);$institution=addslashes($_POST['Institution']);$email1=addslashes($_POST['institution']);$bio=addslashes($_POST['bio']);$platform=$_POST['platform'];         require "mysqlconnect.php";$password='pass';   if ($update==1)   { //update a previous entry       $register="UPDATE elections SET 		'$first', 		'$last',		'$institution',		'$_POST[email1]',		'$filename',		'$bio',		'$platform',		WHERE id='$user_id'";      }      else {      //new entry$register="INSERT INTO elections values ('',		'$first', 		'$last',		'$institution',		'$_POST[email1]',		'$filename',		'$bio',		'$platform',		'$password'		)";				$result = mysql_query($register) or die(mysql_error("		<p>There was a problem with the submission form submission.		Please try to submit the entry again. 		 If you continue to have prolems, please report the problem to the 		 <a href=\"mailto:shardin@umich.edu\">sakaiproject.org webmaster</a>."));		   }		 if ($result==1) {//successful database entry$success=TRUE;}else { $success=FALSE;}	$user_id=mysql_insert_id(); //this is how to query the last entered auto-id entry	//echo $user_id;}}else {$message[]="<li>There was a problem uploading the image, please try again</li>";}}            				?>  